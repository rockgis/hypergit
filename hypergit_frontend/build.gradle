/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/7.4.2/samples
 * This project uses @Incubating APIs which are subject to change.
 */
buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:2.6.6")
    }
}

plugins {
    id "base"
//    id "java"
//    id "application"
    id "com.github.node-gradle.node" version "3.2.1"
    id "org.springframework.boot" version "2.6.6"
}
//
//processResources{
//    dependsOn "buildNextJS"
//}

ext {
    profile = (!project.hasProperty("profile") || !profile)?'dev':profile
}

clean{
    delete "$projectDir/.next"
    delete "$projectDir/node_modules"
}

build {
    dependsOn "buildNextJS"
}

task debugPrint() {
    println("${profile}")
}

task buildNextJS(type:NpmTask){
    dependsOn "npmInstall"
    args = ['run-script','build']
}

task runNextJSServer(type: NpmTask) {
    dependsOn "buildNextJS"
    args = ["run-script", "${profile}"]
}

task yarnBuild(type: YarnTask){
    dependsOn "yarn"
    args = ['build']
}

task yarnRun(type: YarnTask) {
    dependsOn "yarnBuild"
    args = ["run", "${profile}"]
}

//bootJar.enabled(false)
//bootRun {
//    dependsOn "runNextJSServer"
//}

//task copyReactBuildFiles(type:Copy){
//    dependsOn "buildReact"
////    from "$projectDir/build"
////    into "$projectDir/src/main/resources/static"
//}